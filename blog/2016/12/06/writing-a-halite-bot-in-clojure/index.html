<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JCE3PGK5NB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JCE3PGK5NB');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing a Halite Bot in Clojure</title>
    <link rel="icon" type="image/png" href="/images/aleph.png">
    <link rel="stylesheet" href="/style.css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']]
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <nav class="nav">
        <a href="/">Home</a>
        <a href="/about/">About</a>
        <a href="/feed.xml">RSS</a>
    </nav>
    <article>
        <div class="post-date">December 06, 2016</div>
        <h1>Writing a Halite Bot in Clojure</h1>
        <div>
<script src="/javascripts/halite/pixi.min.js"></script>
<script src="/javascripts/halite/parsereplay.js"></script>
<script src="/javascripts/halite/visualizer.js"></script>
</div>
<p><a href="https://halite.io"><img alt="Halite: May the Best Bot Win" src="/images/halitehero.png" /></a></p>
<p><a href="https://halite.io">Halite</a> is a new AI programming competition that was recently released by <a href="https://www.twosigma.com/">Two Sigma</a> and <a href="https://tech.cornell.edu/">Cornell Tech</a>.  It was designed and implemented by two interns at Two Sigma and was run as the annual internal summer programming competition.</p>
<p>While the rules are relatively simple, it proved to be a surprisingly deep challenge.  It's played on a 2D grid and a typical game looks like this:</p>
<p><center></p>
<div id="gameReplay" class="text-center"></div>
<p></center></p>
<div>

  <script type="text/javascript">

    var data = textFromURL("ar1478846062-2923329127.hlt", $("#gameReplay"), function(data) {
        // console.log(data)
        if(data != null) {
            showGame(data, $("#gameReplay"), null, 500, true, true);
        }
    });

  </script>
</div>

<p>Each turn, all players simultaneously issue movement commands to each of their pieces:</p>
<ol>
<li>Move to an adjacent location and capture it if you are stronger than what's currently there.</li>
<li>Stay put and build strength based on the production value of your current location.</li>
</ol>
<p>When two players' pieces are adjacent to each other, they automatically fight.  A much more detailed description is available on the <a href="https://halite.io/rules_game.php">Halite Game Rules page</a>.</p>
<p>Bots are run as subprocesses that communicate with the game environment through <code>STDIN</code> and <code>STDOUT</code>, so it's very simple to create bots in the language of your choice.  While Python, Java, and C++ bot kits were all provided by the game developers, the community quickly produced kits for C#, Rust, Scala, Ruby, Go, PHP, Node.js, OCaml, C, and Clojure.  All the starter packages are available on the <a href="https://halite.io/downloads.php">Halite Downloads page</a>.</p>
<h2>Clojure Bot Basics</h2>
<p>The flow of all bots are the same:</p>
<ol>
<li>Read the initial state (your player ID and the starting game map conditions)</li>
<li>Write your bot's name</li>
<li>Read the current gam emap</li>
<li>Write your moves</li>
<li>GOTO #3</li>
</ol>
<p>The Clojure kit represents the game map as a 2D vector of <code>Site</code> records:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">defrecord </span><span class="nv">Site</span>
<span class="w">    </span><span class="p">[</span><span class="o">^</span><span class="nb">int </span><span class="nv">x</span>
<span class="w">     </span><span class="o">^</span><span class="nb">int </span><span class="nv">y</span>
<span class="w">     </span><span class="o">^</span><span class="nb">int </span><span class="nv">production</span>
<span class="w">     </span><span class="o">^</span><span class="nb">int </span><span class="nv">strength</span>
<span class="w">     </span><span class="o">^</span><span class="nb">int </span><span class="nv">owner</span><span class="p">])</span>
</code></pre></div>

<p>And movement instructions are simple keywords:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">def </span><span class="nv">directions</span><span class="w"> </span><span class="p">[</span><span class="ss">:still</span><span class="w"> </span><span class="ss">:north</span><span class="w"> </span><span class="ss">:east</span><span class="w"> </span><span class="ss">:south</span><span class="w"> </span><span class="ss">:west</span><span class="p">])</span>
</code></pre></div>

<p>A simple bot that finds all the sites you control and issues random moves would look like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">ns </span><span class="nv">MyBot</span>
<span class="w">  </span><span class="p">(</span><span class="ss">:require</span><span class="w"> </span><span class="p">[</span><span class="nv">game</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nv">io</span><span class="p">])</span>
<span class="w">  </span><span class="p">(</span><span class="ss">:gen-class</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">random-moves</span>
<span class="w">  </span><span class="s">&quot;Takes your bot&#39;s ID and a 2D vector of Sites and returns a map from site to direction&quot;</span>
<span class="w">  </span><span class="p">[</span><span class="nv">my-id</span><span class="w"> </span><span class="nv">game-map</span><span class="p">]</span>
<span class="w">  </span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">my-sites</span><span class="w"> </span><span class="p">(</span><span class="nf">-&gt;&gt;</span><span class="w"> </span><span class="nv">game-map</span>
<span class="w">                      </span><span class="nv">flatten</span>
<span class="w">                      </span><span class="p">(</span><span class="nb">filter </span><span class="o">#</span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="ss">:owner</span><span class="w"> </span><span class="nv">%</span><span class="p">)</span><span class="w"> </span><span class="nv">my-id</span><span class="p">)))]</span>
<span class="w">    </span><span class="p">(</span><span class="nb">zipmap </span><span class="nv">my-sites</span><span class="w"> </span><span class="p">(</span><span class="nf">repeatedly</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nf">rand-nth</span><span class="w"> </span><span class="nv">game/directions</span><span class="p">)))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">-main</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">(</span><span class="k">let </span><span class="p">[{</span><span class="ss">:keys</span><span class="w"> </span><span class="p">[</span><span class="nv">my-id</span><span class="w"> </span><span class="nv">productions</span><span class="w"> </span><span class="nv">width</span><span class="w"> </span><span class="nv">height</span><span class="w"> </span><span class="nv">game-map</span><span class="p">]}</span><span class="w"> </span><span class="p">(</span><span class="nf">io/get-init!</span><span class="p">)]</span>
<span class="w">    </span><span class="p">(</span><span class="nb">println </span><span class="s">&quot;MyFirstClojureBot&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">turn</span><span class="w"> </span><span class="p">(</span><span class="nf">range</span><span class="p">)]</span>
<span class="w">      </span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">game-map</span><span class="w"> </span><span class="p">(</span><span class="nf">io/create-game-map</span><span class="w"> </span><span class="nv">width</span><span class="w"> </span><span class="nv">height</span><span class="w"> </span><span class="nv">productions</span><span class="w"> </span><span class="p">(</span><span class="nf">io/read-ints!</span><span class="p">))]</span>
<span class="w">        </span><span class="p">(</span><span class="nf">io/send-moves!</span><span class="w"> </span><span class="p">(</span><span class="nf">random-moves</span><span class="w"> </span><span class="nv">my-id</span><span class="w"> </span><span class="nv">game-map</span><span class="p">))))))</span>
</code></pre></div>

<h2>Next Steps</h2>
<p>There are currently almost 900 bots competing on the site, but <a href="https://halite.io/leaderboard.php?field=language&amp;value=Clojure&amp;heading=Clojure">there are only a handful written in Clojure</a>!  I'm sure the Clojure community could do some interesting things here, so head over to <a href="https://halite.io">halite.io</a>, sign-up using your Github account, and <a href="https://halite.io/downloads/starterpackages/Halite-Clojure-Starter-Package.zip">download the Clojure starter kit</a>.</p>
    </article>
    <footer class="post-footer">
        <a href="/" class="home-link">‚Üê Back to Home</a>
    </footer>
</body>
</html>